{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useLocation}from'react-router-dom';import axios from'axios';import{useCart}from'../contexts/cartContext';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const Success=()=>{const navigate=useNavigate();const location=useLocation();const{clearCart}=useCart();const[error,setError]=useState(null);const[isLoading,setIsLoading]=useState(true);useEffect(()=>{const saveOrder=async()=>{const sessionId=new URLSearchParams(location.search).get('session_id');if(!sessionId){setError('Invalid session. Please try again.');setIsLoading(false);return;}try{const email=localStorage.getItem('email');const address=JSON.parse(localStorage.getItem('userAddress')||'{}');if(!email||!address||!address.addressLine1){setError('Missing user information. Please log in and ensure an address is saved.');setIsLoading(false);return;}console.log('Saving order with:',{sessionId,email,address});console.log('Saving order to:',`${process.env.REACT_APP_API_BASE_URL}/api/customers/orders/save`);// Debug log\nconst response=await axios.post(`${process.env.REACT_APP_API_BASE_URL}/api/customers/orders/save`,{email,address,sessionId});console.log('Order saved:',response.data);clearCart();setIsLoading(false);navigate('/orders');// Redirect to order history\n}catch(error){var _error$response,_error$response$data;console.error('Error saving order:',error);setError(`Failed to save order: ${((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message}`);setIsLoading(false);}};saveOrder();},[location,navigate,clearCart]);return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-5 text-center\",children:isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Processing Your Order...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please wait while we finalize your order.\"})]}):error?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Processing Failed\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>navigate('/cart'),children:\"Return to Cart\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Placed Successfully!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your order has been processed. Check your order history for details.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>navigate('/orders'),children:\"View Order History\"})]})});};export default Success;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","axios","useCart","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Success","navigate","location","clearCart","error","setError","isLoading","setIsLoading","saveOrder","sessionId","URLSearchParams","search","get","email","localStorage","getItem","address","JSON","parse","addressLine1","console","log","process","env","REACT_APP_API_BASE_URL","response","post","data","_error$response","_error$response$data","message","className","children","onClick"],"sources":["D:/ITD/zepto2/zepto2/src/pages/success.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { useCart } from '../contexts/cartContext';\r\n\r\nconst Success = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { clearCart } = useCart();\r\n  const [error, setError] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const saveOrder = async () => {\r\n      const sessionId = new URLSearchParams(location.search).get('session_id');\r\n      if (!sessionId) {\r\n        setError('Invalid session. Please try again.');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const email = localStorage.getItem('email');\r\n        const address = JSON.parse(localStorage.getItem('userAddress') || '{}');\r\n\r\n        if (!email || !address || !address.addressLine1) {\r\n          setError('Missing user information. Please log in and ensure an address is saved.');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        console.log('Saving order with:', { sessionId, email, address });\r\n        console.log('Saving order to:', `${process.env.REACT_APP_API_BASE_URL}/api/customers/orders/save`); // Debug log\r\n\r\n        const response = await axios.post(`${process.env.REACT_APP_API_BASE_URL}/api/customers/orders/save`, {\r\n          email,\r\n          address,\r\n          sessionId,\r\n        });\r\n\r\n        console.log('Order saved:', response.data);\r\n        clearCart();\r\n        setIsLoading(false);\r\n        navigate('/orders'); // Redirect to order history\r\n      } catch (error) {\r\n        console.error('Error saving order:', error);\r\n        setError(`Failed to save order: ${error.response?.data?.message || error.message}`);\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    saveOrder();\r\n  }, [location, navigate, clearCart]);\r\n\r\n  return (\r\n    <div className=\"container mt-5 text-center\">\r\n      {isLoading ? (\r\n        <>\r\n          <h2>Processing Your Order...</h2>\r\n          <p>Please wait while we finalize your order.</p>\r\n        </>\r\n      ) : error ? (\r\n        <>\r\n          <h2>Order Processing Failed</h2>\r\n          <p>{error}</p>\r\n          <button className=\"btn btn-primary\" onClick={() => navigate('/cart')}>\r\n            Return to Cart\r\n          </button>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <h2>Order Placed Successfully!</h2>\r\n          <p>Your order has been processed. Check your order history for details.</p>\r\n          <button className=\"btn btn-primary\" onClick={() => navigate('/orders')}>\r\n            View Order History\r\n          </button>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Success;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}