"use strict";(self.webpackChunkzepto2=self.webpackChunkzepto2||[]).push([[837],{4837:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});var l=a(5043),d=a(4432),r=a(8231),n=a(6213),t=a(579);const o=function(){const{cartItems:e,addToCart:s,removeFromCart:a,clearCart:o,cartTotal:i,cartCount:c}=(0,d._)(),m=(0,r.Zp)(),[u,h]=(0,l.useState)(!1),[x,b]=(0,l.useState)(!0),[p,j]=(0,l.useState)(null),[N,v]=(0,l.useState)({addressLine1:"",houseNo:"",building:"",landmark:"",label:"Home",zipCode:""}),[g,f]=(0,l.useState)(""),[C,y]=(0,l.useState)(null),[k,S]=(0,l.useState)(""),[P,A]=(0,l.useState)(""),w=[{code:"NEW100",discount:100,minPurchase:150,description:"Get \u20b9100 off on orders above \u20b9150"}],I=["560001","560002","560003","560004","560005","560006","560007","560008","560009","560010","560011","560012","560013","560014","560015","560016","560017","560018","560019","560020","560021","560022","560023","560024","560025","560026","560027","560028","560029","560030","560031","560032","560033","560034","560035","560036","560037","560038","560039","560040","560041","560042","560043","560044","560045","560046","560047","560048","560049","560050","560051","560052","560053","560054","560055","560056","560057","560058","560059","560060","560061","560062","560063","560064","560065","560066","560067","560068","560069","560070","560071","560072","560073","560074","560075","560076","560077","560078","560079","560080","560081","560082","560083","560084","560085","560086","560087","560088","560089","560090","560091","560092","560093","560094","560095","560096","560097","560098","560099","560100"],L=.1*i,F=C?C.discount:0,z=i-L-F;(0,l.useEffect)((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return;console.log("Fetching saved address from:","http://15.207.88.145:5000/api/customers/users/address");const s=await n.A.get("http://15.207.88.145:5000/api/customers/users/address",{headers:{Authorization:`Bearer ${e}`}});console.log("Fetched saved address:",s.data),s.data.address&&(j(s.data.address),localStorage.setItem("userAddress",JSON.stringify(s.data.address)))}catch(e){console.error("Error fetching saved address:",e);try{const e=JSON.parse(localStorage.getItem("userAddress"));e&&e.addressLine1&&j(e)}catch(s){console.error("Error parsing userAddress:",s)}}})()}),[]);const E=e=>{const{name:s,value:a}=e.target;v((e=>({...e,[s]:a}))),A("")},q=e=>!!I.includes(e.zipCode);return(0,t.jsxs)("div",{className:"container mt-4",children:[(0,t.jsxs)("h2",{children:["Your Cart (",c," items)"]}),0===e.length?(0,t.jsxs)("div",{className:"alert alert-info",children:["Your cart is empty."," ",(0,t.jsx)("button",{className:"btn btn-link",onClick:()=>m("/"),children:"Continue shopping"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-lg-8",children:e.map((e=>(0,t.jsx)("div",{className:"card mb-3",children:(0,t.jsxs)("div",{className:"row g-0",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("img",{src:`data:image/png;base64,${e.ProductImage}`,className:"img-fluid rounded-start",alt:e.ProductName})}),(0,t.jsx)("div",{className:"col-md-8",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:e.ProductName}),(0,t.jsxs)("p",{className:"card-text",children:["\u20b9",e.ProductPrice]}),(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[(0,t.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>a(e.ProductID),children:"-"}),(0,t.jsx)("span",{className:"mx-2",children:e.quantity}),(0,t.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>s(e),children:"+"}),(0,t.jsxs)("span",{className:"ms-auto fw-bold",children:["\u20b9",(e.quantity*parseFloat(e.ProductPrice)).toFixed(2)]})]})]})})]})},e.ProductID)))}),(0,t.jsx)("div",{className:"col-lg-4",children:(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"Order Summary"}),(0,t.jsxs)("div",{className:"d-flex justify-content-between mb-2",children:[(0,t.jsxs)("span",{children:["Subtotal (",c," items)"]}),(0,t.jsxs)("span",{children:["\u20b9",i.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"d-flex justify-content-between mb-2 text-success",children:[(0,t.jsx)("span",{children:"Discount (10%)"}),(0,t.jsxs)("span",{children:["-\u20b9",L.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"mt-3 mb-3",children:[(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("input",{type:"text",className:"form-control",placeholder:"Coupon code",value:g,onChange:e=>f(e.target.value),disabled:C}),C?(0,t.jsx)("button",{className:"btn btn-outline-danger",type:"button",onClick:()=>{y(null),f(""),S("")},children:"Remove"}):(0,t.jsx)("button",{className:"btn btn-outline-primary",type:"button",onClick:()=>{if(S(""),!g)return void S("Please enter a coupon code");const e=w.find((e=>e.code===g.toUpperCase()));e?i<e.minPurchase?S(`Minimum purchase of \u20b9${e.minPurchase} required for this coupon`):y(e):S("Invalid coupon code")},children:"Apply"})]}),k&&(0,t.jsx)("div",{className:"text-danger small mt-1",children:k}),C&&(0,t.jsxs)("div",{className:"text-success small mt-1",children:["Coupon applied: ",C.code," (-\u20b9",C.discount,")"]})]}),C&&(0,t.jsxs)("div",{className:"d-flex justify-content-between mb-2 text-success",children:[(0,t.jsxs)("span",{children:["Coupon Discount (",C.code,")"]}),(0,t.jsxs)("span",{children:["-\u20b9",F.toFixed(2)]})]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:"d-flex justify-content-between fw-bold",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["\u20b9",z.toFixed(2)]})]}),(0,t.jsx)("button",{className:"btn btn-primary w-100 mt-3",onClick:()=>{if(!localStorage.getItem("token"))return alert("Please log in to proceed."),void m("/Login");h(!0)},children:"Proceed to Checkout"}),(0,t.jsx)("button",{className:"btn btn-outline-danger w-100 mt-2",onClick:o,children:"Clear Cart"})]})})})]}),u&&(0,t.jsx)("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog modal-dialog-centered",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:"Delivery Address"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>h(!1)})]}),(0,t.jsxs)("div",{className:"modal-body",children:[P&&(0,t.jsx)("div",{className:"alert alert-danger",children:P}),p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Saved Address"}),(0,t.jsxs)("p",{children:[p.label,": ",p.addressLine1,","," ",p.houseNo,", ",p.building,p.landmark?`, ${p.landmark}`:"",p.zipCode?`, ${p.zipCode}`:""]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{className:"btn btn-sm btn-primary me-2",onClick:()=>b(!0),disabled:x,children:"Use This Address"}),(0,t.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>b(!1),children:"Add New Address"})]})]}),!x&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Address Line 1 *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"addressLine1",value:N.addressLine1,onChange:E,placeholder:"Street address",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"House No. & Floor *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"houseNo",value:N.houseNo,onChange:E,placeholder:"Enter house no. and floor",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Building & Block No. *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"building",value:N.building,onChange:E,placeholder:"Enter building and block no.",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"ZIP Code *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"zipCode",value:N.zipCode,onChange:E,placeholder:"Enter Bangalore ZIP code (e.g., 560001)",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Landmark & Area Name (Optional)"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"landmark",value:N.landmark,onChange:E,placeholder:"Enter landmark and area name"})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Add Address Label"}),(0,t.jsxs)("select",{className:"form-select",name:"label",value:N.label,onChange:E,children:[(0,t.jsx)("option",{value:"Home",children:"Home"}),(0,t.jsx)("option",{value:"Work",children:"Work"}),(0,t.jsx)("option",{value:"Other",children:"Other"})]})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Address Line 1 *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"addressLine1",value:N.addressLine1,onChange:E,placeholder:"Street address",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"House No. & Floor *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"houseNo",value:N.houseNo,onChange:E,placeholder:"Enter house no. and floor",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Building & Block No. *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"building",value:N.building,onChange:E,placeholder:"Enter building and block no.",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"ZIP Code *"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"zipCode",value:N.zipCode,onChange:E,placeholder:"Enter Bangalore ZIP code (e.g., 560001)",required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Landmark & Area Name (Optional)"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"landmark",value:N.landmark,onChange:E,placeholder:"Enter landmark and area name"})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Add Address Label"}),(0,t.jsxs)("select",{className:"form-select",name:"label",value:N.label,onChange:E,children:[(0,t.jsx)("option",{value:"Home",children:"Home"}),(0,t.jsx)("option",{value:"Work",children:"Work"}),(0,t.jsx)("option",{value:"Other",children:"Other"})]})]})]})]}),(0,t.jsx)("div",{className:"modal-footer",children:(0,t.jsx)("button",{type:"button",className:"btn btn-primary w-100",onClick:async()=>{try{const e=localStorage.getItem("token");if(!e)return alert("Please log in to proceed."),void m("/Login");let s=x&&p?p:N;if(x){if(!p)return void A("No saved address found. Please add a new address.");if(!q(p))return void A("Saved address is not serviceable. Please add a Bangalore address with a valid ZIP code.")}else{if(!N.addressLine1||!N.houseNo||!N.building||!N.zipCode)return void A("Please fill in all required address fields, including ZIP code.");if(!q(N))return void A("This address is not serviceable. Please use a valid Bangalore ZIP code (e.g., 560001).");console.log("Saving new address to:","http://15.207.88.145:5000/api/customers/users/update-address");const a=await n.A.put("http://15.207.88.145:5000/api/customers/users/update-address",{address:N},{headers:{Authorization:`Bearer ${e}`}});console.log("Saved new address:",a.data),j(N),localStorage.setItem("userAddress",JSON.stringify(N)),s=N}localStorage.setItem("userAddress",JSON.stringify(s)),h(!1),m("/payment",{state:{totalAfterDiscount:z}})}catch(a){var e,s;console.error("Error saving address:",a),A((null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to save address.")}},children:p&&x?"Continue with Saved Address":"Save & Continue"})})]})})})]})]})}}}]);
//# sourceMappingURL=837.b15c19c8.chunk.js.map